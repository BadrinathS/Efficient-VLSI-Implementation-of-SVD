P=[1 2 3 4;5 6 7 8;9 10 11 12; 13 14 15 16];
P11=[1 2;5 6];
P12=[3 4;7 8];
P21=[9 10;13 14];
P22=[11 12;15 16];


for i=1:10
theta1 = thetal(P11(1,1),P11(1,2),P11(2,1),P11(2,2));
theta2 = thetal(P22(1,1),P22(1,2),P22(2,1),P22(2,2));
theta3 = thetar(P11(1,1),P11(1,2),P11(2,1),P11(2,2));
theta4 = thetar(P22(1,1),P22(1,2),P22(2,1),P22(2,2));

P11=[1 -tan(theta1);tan(theta1) 1]*P11*[1 tan(theta3);-tan(theta3) 1];
P22=[1 -tan(theta2);tan(theta2) 1]*P22*[1 tan(theta4);-tan(theta4) 1];
P12=[1 -tan(theta1);tan(theta1) 1]*P12*[1 tan(theta4);-tan(theta4) 1];
P21=[1 -tan(theta2);tan(theta2) 1]*P21*[1 tan(theta3);-tan(theta3) 1];

[P11(1,2), P12(1,1)]=swap(P11(1,2), P12(1,1));
[P11(2,2), P22(1,1)]=swap(P11(2,2), P22(1,1));
[P11(2,1), P21(1,1)]=swap(P11(2,1), P21(1,1));
[P21(2,2), P22(2,1)]=swap(P21(2,2), P22(2,1));
[P12(2,2), P22(1,2)]=swap(P12(2,2), P22(1,2));
[P12(2,1), P21(1,2)]=swap(P12(2,1), P21(1,2));
end
[U1, V1]=svd(P);
A=[0.367*P11 0.6073*P12;0.6073*P21 0.367*P22];
